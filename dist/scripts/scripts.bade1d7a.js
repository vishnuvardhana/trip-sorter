"use strict";angular.module("travelFinderApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ngMaterial","angular-loading-bar","ngAnimate"]).config(["cfpLoadingBarProvider",function(a){a.includeSpinner=!1}]).config(["$mdThemingProvider",function(a){a.theme("default").primaryPalette("pink",{"default":"500","hue-1":"700","hue-2":"800"})}]).constant("API_URL","response.json").constant("underscore",window._).constant("moment",window.moment).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).otherwise({redirectTo:"/"})}]),angular.module("travelFinderApp").controller("MainCtrl",["$scope","fetchDataService","underscore","$timeout","searchValidation","tripSorterFactory","$mdDialog",function(a,b,c,d,e,f,g){function h(){d(function(){i().then(function(b){var d=b.data.deals;a.data.departureCities=f.sortArray(c.uniq(c.collect(d,"departure"))),a.data.arrivalCities=f.sortArray(c.uniq(c.collect(d,"arrival")))})},1e3)}a.underscore=c,a.data={},a.userEvents={},a.data.departureCities=[],a.data.arrivalCities=[],a.data.selectedDeparture="",a.data.selectedArrival="",a.data.sortBy="1",a.data.recommendedResults={},a.data.considerDiscount=!1,a.userEvents.showValidationErrors=function(a){g.show(g.alert().parent(angular.element(document.querySelector("body"))).clickOutsideToClose(!0).title("Invalid Search").textContent(a).ok("Got it!"))};var i=function(){return b.getRemoteData()};h(),a.userEvents.swapAndSearch=function(){var b=a.data.selectedArrival;a.data.selectedArrival=a.data.selectedDeparture,a.data.selectedDeparture=b,a.userEvents.searchDeals()},a.userEvents.resetSearch=function(b){b&&(a.data.selectedDeparture="",a.data.selectedArrival=""),a.data.recommendedResults={}},a.userEvents.searchDeals=function(){return a.data.selectedDeparture&&a.data.selectedArrival?e.isAValidSearch(a.data.selectedDeparture,a.data.selectedArrival)?void a.userEvents.showValidationErrors("Departure and Arrival can't be same "):void i().then(function(b){a.userEvents.resetSearch(!1);var c=b.data.deals,d=b.data.currency,e="",g=f.createGraphAndGetBestPath(c,a.data.departureCities,a.data.arrivalCities,a.data.selectedDeparture,a.data.selectedArrival);switch(a.data.recommendedResults.currency=d,a.data.sortBy){case"1":a.data.recommendedResults.deals=g.cheapest;break;case"2":a.data.recommendedResults.deals=g.fastest;break;case"3":a.data.recommendedResults.deals=validDestinations,a.data.recommendedResults.totalCost=e.totalCost,a.data.recommendedResults.totalDuration=e.totalDuration}return a.data.recommendedResults.deals.length>1&&(e=f.calculateTotalTimeAndCost(a.data.recommendedResults.deals),a.data.recommendedResults.totalCost=e.totalCost,a.data.recommendedResults.totalDuration=e.totalDuration),!0}):void a.userEvents.showValidationErrors("Select a valid Departure and Arrival")}}]),angular.module("travelFinderApp").factory("fetchDataService",["$http","API_URL",function(a,b){var c=function(){return a({url:b,method:"get"})};return{getRemoteData:c}}]),angular.module("travelFinderApp").factory("searchValidation",["underscore",function(a){var b=function(a,b){return a===b};return{isAValidSearch:b}}]).factory("tripSorterFactory",["underscore",function(a){function b(){this.vertices=[],this.edges=[],this.data=[],this.numberOfEdges=0}var c=a;b.prototype.addVertex=function(a,b){this.vertices.push(a),this.edges[a]=[],this.data[a]=b},b.prototype.addEdge=function(a,b){this.edges[a]||(this.edges[a]=[]),this.edges[b]||(this.edges[b]=[]),-1===this.edges[a].indexOf(b)&&this.edges[a].push(b),-1===this.edges[b].indexOf(a)&&this.edges[b].push(a),this.numberOfEdges++},b.prototype.pathFromTo=function(a,b){if(!~this.vertices.indexOf(a))return console.log("Vertex not found");var d=[];d.push(a);var e=[];e[a]=!0;for(var f=[];d.length;)for(var g=d.shift(),h=0;h<this.edges[g].length;h++)e[this.edges[g][h]]||(e[this.edges[g][h]]=!0,d.push(this.edges[g][h]),f[this.edges[g][h]]=g);if(!e[b])return void 0;for(var i=[],j=b;j!=a;j=f[j])i.push([c.filter(this.data[f[j]],{arrival:j})]);return i.reverse()};var d=function(a,c,d,e,g){var j=new b,k=[],l=0,m=0,n=0,o=0,p={cheapest:[],fastest:[],all:[]};for(c.forEach(function(b,c){j.addVertex(b,f(a,b))}),a.forEach(function(a,b){a.arrival&&j.addEdge(a.departure,a.arrival)}),k=j.pathFromTo(e,g),l=k.length,n=0;l>n;n+=1)for(m=k[n].length,o=0;m>o;o+=1)p.cheapest.push(h(k[n][o],!0)),p.fastest.push(i(k[n][o],!0));return p},e=function(a){return a.sort(function(a,b){return b>a?-1:a>b?1:0})},f=function(a,b){return c.filter(a,{departure:b})},g=function(a){var b=0,c=0,d=0;return a.forEach(function(a,e){b+=Number(a.duration.h),c+=Number(a.duration.m),d+=a.cost}),{totalCost:d,totalDuration:{h:b+Math.floor(c/60),m:c%60}}},h=function(a,b){var d=c.min(a,function(a){return a.discount?a.cost-a.cost*a.discount/100:a.cost});return d&&d.discount&&(d.discountedPrice=d.cost-d.cost*d.discount/100),d},i=function(a){var b=c.min(c.pluck(a,"duration"),function(a){return a.h}),d=a.filter(function(a,c){return b.h===a.duration.h?a:void 0});return c.min(d,function(a){return a.duration.m&&a.cost-(a.cost-a.discount)/100})};return{sortArray:e,getMatchedDepartures:f,calculateTotalTimeAndCost:g,getCheapestTravel:h,getFastestTravel:i,createGraphAndGetBestPath:d}}]),angular.module("travelFinderApp").run(["$templateCache",function(a){a.put("views/main.html",'<md-content class="md-padding" layout-xs="column" layout="row"> <div flex-xs flex-gt-xs="100" layout="column" flex-xs="100"> <div class="md-padding"> <h5 class="md-title">Trip Sorter</h5> <h5 class="md-subhead"> select a <i>Departure city</i> and <i>Arrival city</i> to plan your journey ! <br> Make use of quick filters to find <b>best</b> options </h5> </div> <md-card class="md-whiteframe-3dp"> <md-card-title> <div layout="column" layout-align="start" flex flex-xs="100"> <div layout="row" layout-align="start" flex class="md-padding"> <md-input-container flex="45" flex-xs="45"> <label class="font-light-color"> Departure City </label> <md-select name="favoriteColor" ng-model="data.selectedDeparture"> <md-optgroup label="Departure City"> <md-option ng-repeat="departureCity in data.departureCities" ng-value="departureCity"> {{departureCity}} </md-option> </md-optgroup> </md-select> </md-input-container> <div flex="10" class="text-align-center" flex-xs="10"> <md-button class="md-fab md-button md-ink-ripple hidden-xs" ng-click="userEvents.swapAndSearch()"> <-> </-></md-button> </div> <md-input-container flex="45" flex-xs="45"> <label class="font-light-color"> Arrival City </label> <md-select name="favoriteColor" ng-model="data.selectedArrival"> <md-optgroup label="Arrival City"> <md-option ng-repeat="arrivalCity in data.arrivalCities" ng-value="arrivalCity"> {{arrivalCity}} </md-option> </md-optgroup> </md-select> </md-input-container> </div> <div layout="row" layout-align="start" class="md-padding"> <div flex="50" flex-xs="50"> <md-radio-group ng-model="data.sortBy" layout="row" ng-click="userEvents.searchDeals()"> <md-radio-button value="1" class="md-primary" ng-style="{\'display\':\'inline\'}">Cheapest</md-radio-button> <md-radio-button value="2" ng-style="{\'display\':\'inline\'}"> Fastest </md-radio-button> <md-radio-button value="3" ng-style="{\'display\':\'inline\'}">All <span ng-if="data.recommendedResults.numberOfDeals">({{data.recommendedResults.numberOfDeals}})</span></md-radio-button> </md-radio-group> </div> <div flex="50" flex-xs="50"> <md-button class="md-raised md-primary search-button" ng-click="userEvents.searchDeals()">search</md-button> <md-button ng-show="data.recommendedResults.deals" class="md-raised md-default fr" ng-click="userEvents.resetSearch(true)">Reset</md-button> </div> </div> </div> </md-card-title> </md-card> <md-card class="md-whiteframe-1dp md-padding" ng-show="data.recommendedResults.deals"> <md-content> <md-list> <md-list-item class="md-2-line" ng-repeat="deal in data.recommendedResults.deals" layout="row" layout-align="start" flex="50" flex-xs="100"> <div class="md-list-item-text"> <h3> <div class="fl">{{deal.departure}} > {{deal.arrival}}</div> <div class="fr"><b> <span> {{ deal.cost }}</span></b> {{data.recommendedResults.currency}} </div></h3> <h4> <span class="light-text-color">{{deal.transport}}</span> {{deal.reference}} <span class="light-text-color"> for {{deal.duration.h}}h {{deal.duration.m}} </span></h4> </div> </md-list-item> <md-list-item class="md-2-line" ng-if="data.recommendedResults.totalCost" layout="row" layout-align="start" flex="50" flex-xs="100"> <div class="md-list-item-text"> <table class="table"> <tbody> <tr> <td colspan="2">Total</td> <td colspan="2" class="text-align-center">{{data.recommendedResults.totalDuration.h}} h {{data.recommendedResults.totalDuration.m}} </td> <td colspan="2" class="fr">{{data.recommendedResults.totalCost}} {{data.recommendedResults.currency}}</td> </tr> </tbody> <table> </table></table></div> </md-list-item> </md-list> </md-content> </md-card> </div> </md-content>')}]);